{{extend 'layout.html'}}
<div id="map-canvas"></div>
<script type="text/javascript">
  var agencies = {{=XML(agencies)}}
  var origin = toCoord(agencies[0].geolocation)
  console.log(agencies);
  function initialize() {
    var mapOptions = {
      center: new google.maps.LatLng(origin[0], origin[1]),
      zoom: 8,
      mapTypeId: google.maps.MapTypeId.ROADMAP
    };
    var map = new google.maps.Map(document.getElementById("map-canvas"),
      mapOptions);
    for(var i = 0; i < agencies.length; i++) {
      var agency = agencies[i];
      var coords = toCoord(agency.geolocation);
      console.log(coords);

      //Information popup
      

      var marker = new google.maps.Marker({
          position: new google.maps.LatLng(coords[0], coords[1]),
          map: map,
          title: agency.name
      });
      console.log(marker);
    }
  }
  google.maps.event.addDomListener(window, 'load', initialize);

  function toCoord(point) {
    var coords = point.match(/-?[0-9]+\.[0-9]+/g)
    for(var i = 0; i<coords.length; i++) {
      coords[i] = parseFloat(coords[i])
    }
    return coords 
  }
</script>
<style>
  #map-canvas {
    width: 100%;
    height: 300px;
  }
</style>
